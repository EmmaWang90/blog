# 表空间拷贝性能提升
## 代码走查
浏览代码，梳理流程，发现几个可以优化的地方，比如写数据时批量写入。
## 使用线程池
涉及42个表，数目有点多，使用线程池处理会比较快，但是要等待线程池处理完毕，实现同步操作。
## 使用pgadmin工具
在dashboard 中查看链接的状态，发现很多链接是active 的，但数据没有被写入。查看pg_stat_activity表，发现很多线程在进行查询操作，进一步定位代码发现，持久层在写入数据时，需要判断数据库中是否已经存在这个数据，以决定sql语句中使用insert还是modify。这里可以使用ServiceContxt 设定insert，跳过判断。
## 注意各种现象
以上修改之后，理论上没有什么问题了，但每次都卡在34、35个表之后，再也没有相关日志了，控制台相应缓慢，老年代占用超99%，后来发现rest报outof memory，才突然想到内存问题。
默认最大内存2个G，这次测试数据量有点大，并且还要进行表空间的拷贝，等于内存中要放置两份数据，处理到后面几张表时内存不够，导致上述几个现象。